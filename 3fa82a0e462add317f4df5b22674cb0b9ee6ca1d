{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ec73ee39_330b3f3c",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/admission/servlet/GerritAdmissionWebhook.java",
        "patchSetId": 15
      },
      "lineNbr": 65,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-05-17T15:27:16Z",
      "side": 1,
      "message": "This is now inconsistent. We have in principal 3 cluster modes:\n\n- Single primary\n- HIGH_AVAILABILITY\n- MULITSITE\n\nThe Single Primary mode is implicit and installed when a single replica is configured. In that case, the high-availability plugin was not installed and some configuration omitted, since it didn\u0027t make sense.\nWith multisite you do it differently and install everything even, if there is only a single replica pod. This causes weird edge cases everywhere, e.g. how to deal with pull-replication in that case.\nWe should either handle it the same as in high-availability, i.e. as long as only a single primary is configured, all multi-primary stuff is omitted.\nAlternatively, we could make it a dedicated cluster mode, but since it is an operator level option, I think that would just make it unnecessarily complicated, since it would require to reconfigure the operator, when scaling up from 1 to 2+ primary pods.",
      "range": {
        "startLine": 65,
        "startChar": 9,
        "endLine": 65,
        "endChar": 92
      },
      "revId": "3fa82a0e462add317f4df5b22674cb0b9ee6ca1d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fdbe35f7_de046260",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/admission/servlet/GerritAdmissionWebhook.java",
        "patchSetId": 15
      },
      "lineNbr": 66,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-05-17T15:27:16Z",
      "side": 1,
      "message": "This breaks the style that is in general used here. The whole condition should be handled in a method that is descriptive for what it checks. I.e. you should keep the method name as before or maybe adapt it to `noRefDbConfiguredForMultiPrimary` and just extend it.",
      "range": {
        "startLine": 65,
        "startChar": 8,
        "endLine": 66,
        "endChar": 37
      },
      "revId": "3fa82a0e462add317f4df5b22674cb0b9ee6ca1d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "336b72d7_5bee0d6c",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/admission/servlet/GerritClusterAdmissionWebhook.java",
        "patchSetId": 15
      },
      "lineNbr": 57,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-05-17T15:27:16Z",
      "side": 1,
      "message": "Put this condition in a method with a descriptive method to match the style used in other places here.",
      "range": {
        "startLine": 57,
        "startChar": 8,
        "endLine": 57,
        "endChar": 85
      },
      "revId": "3fa82a0e462add317f4df5b22674cb0b9ee6ca1d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7121682_dbdc7067",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/admission/servlet/GerritClusterAdmissionWebhook.java",
        "patchSetId": 15
      },
      "lineNbr": 137,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-05-20T09:52:06Z",
      "side": 1,
      "message": "This method should check that there are more than 1 replica and PRIMARY",
      "revId": "3fa82a0e462add317f4df5b22674cb0b9ee6ca1d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "012b0820_0eb95fbb",
        "filename": "operator/src/test/java/com/google/gerrit/k8s/operator/server/GerritClusterAdmissionWebhookTest.java",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-05-17T15:27:16Z",
      "side": 1,
      "message": "Could you add tests for multisite as well or parameterize the existing tests?",
      "revId": "3fa82a0e462add317f4df5b22674cb0b9ee6ca1d",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}