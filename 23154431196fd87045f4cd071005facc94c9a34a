{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3ac11fc5_4a146a23",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-07-11T09:03:30Z",
      "side": 1,
      "message": "fyi: git init itself will not overwrite anything, if the repository already exists, so it is safe to just run it on an existing repository [1].\n\nHowever, providing the caller with a proper status code and message is a very valid improvement.\n\n[1] https://git-scm.com/docs/git-init",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c047f578_c9afdbfb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1145289
      },
      "writtenOn": "2022-07-12T01:01:36Z",
      "side": 1,
      "message": "I also read the official doc you pointer many years ago.\nAnd I know it doesn\u0027t describe its strict behavior.\n\nIn actuality, git-init does create/rename config.lock and config.\n(You can check easily by using filesystem watcher tools.)\nAnd just in my case, some *.git/config are broken.\n\nIt might be a bug in Git. But at least your opinion is not reasonable.",
      "parentUuid": "3ac11fc5_4a146a23",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "238515e2_8d68026d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-07-12T05:55:01Z",
      "side": 1,
      "message": "This indeed seems to be a bug or at least the documentation should be improved. Maybe you could report it to the git mailing list. I can at least see that it touches .git/config although it didn\u0027t modify it. That git init reads the config would not surprise me, but it shouldn\u0027t break it. It should also respect existing locks and properly remove its own.\nRegardless, this is not a discussion that should be part of this repository. Your change definitely improves the script, especially if it prohibits issues as you observed them.",
      "parentUuid": "c047f578_c9afdbfb",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6bcc9edc_92efe45a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1145289
      },
      "writtenOn": "2022-07-14T06:21:36Z",
      "side": 1,
      "message": "My first priority is to run my Gerrit master-replica with no issue.\n\nSurely I can report to the git mailing list and I\u0027ll do it.\nI found some reports that are similar to the issue I\u0027m facing.\nAnd there is no answer describing the root cause.\nI estimate it will require long terms to fix it.\n\nMy patch is a hot-fix.\n\n\u003e I can at least see that it touches .git/config although it didn\u0027t modify it.\n\nDid you verify it in your environment? It doesn\u0027t just touch but more calling systemcalls.\n\nI\u0027m not sure as I failed to reproduce. But I suppose `config` is broken by racing `git push` from the master and `/new` API.\n\n```\n/ # inotifywait -m /tmp/hoge.git/\nSetting up watches.\nWatches established.\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ CREATE config.lock\n/tmp/hoge.git/ OPEN config.lock\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ ATTRIB config.lock\n/tmp/hoge.git/ MODIFY config.lock\n/tmp/hoge.git/ MODIFY config.lock\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ CLOSE_WRITE,CLOSE config.lock\n/tmp/hoge.git/ MOVED_FROM config.lock\n/tmp/hoge.git/ MOVED_TO config\n/tmp/hoge.git/ ATTRIB config\n/tmp/hoge.git/ CREATE config.lock\n/tmp/hoge.git/ OPEN config.lock\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ ATTRIB config.lock\n/tmp/hoge.git/ MODIFY config.lock\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ CLOSE_WRITE,CLOSE config.lock\n/tmp/hoge.git/ MOVED_FROM config.lock\n/tmp/hoge.git/ MOVED_TO config\n/tmp/hoge.git/ CREATE config.lock\n/tmp/hoge.git/ OPEN config.lock\n/tmp/hoge.git/ OPEN config\n/tmp/hoge.git/ ACCESS config\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ ATTRIB config.lock\n/tmp/hoge.git/ MODIFY config.lock\n/tmp/hoge.git/ CLOSE_NOWRITE,CLOSE config\n/tmp/hoge.git/ CLOSE_WRITE,CLOSE config.lock\n/tmp/hoge.git/ MOVED_FROM config.lock\n/tmp/hoge.git/ MOVED_TO config\n```",
      "parentUuid": "238515e2_8d68026d",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b01f3b5_7c59813c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-07-14T06:31:06Z",
      "side": 1,
      "message": "Yes, I would also guess that the issue is because of concurrent access of the config file, which should have been prevented by the lock.\n\nI also agree that we should bring in your hotfix asap. Please fix the nits I mentioned in the other comments and we can submit this fix.\n\nThanks for analysing and hot-fixing the issue.",
      "parentUuid": "6bcc9edc_92efe45a",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b64064ed_330b5cad",
        "filename": "container-images/apache-git-http-backend/tools/create_repo.sh",
        "patchSetId": 2
      },
      "lineNbr": 2,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-07-11T09:03:30Z",
      "side": 1,
      "message": "unrelated change",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae5a7e39_8eec7b42",
        "filename": "container-images/apache-git-http-backend/tools/create_repo.sh",
        "patchSetId": 2
      },
      "lineNbr": 12,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2022-07-11T09:03:30Z",
      "side": 1,
      "message": "What is that supposed to mean?\nJust remove this line, since MESSAGE will always be set in the following conditional block.",
      "revId": "23154431196fd87045f4cd071005facc94c9a34a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}