{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b4ecf10a_b5e026f4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2024-02-16T09:42:21Z",
      "side": 1,
      "message": "to",
      "range": {
        "startLine": 18,
        "startChar": 84,
        "endLine": 18,
        "endChar": 87
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18b837cd_d9c9a6bb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2024-02-16T09:42:21Z",
      "side": 1,
      "message": "nit: needs reformatting",
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "44b9f15f_6c81f0a9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T08:12:34Z",
      "side": 1,
      "message": "Just to bring up a few points that will need to be changed to support this:\n\nSharing the filesystem for git repositories is currently required to support:\n\n- sharing repositories without replication between Gerrit Primaries and Replicas\n- Allowing to run Git GC in a separate Pod (managed by a CronJob). If we don\u0027t share the repositories, Git GC has to be done in a sidecar container within each Gerrit pod.\n\nI believe this second point should be handled as well. Some discussions we had at SAP about that resulted in the idea to make GC more intelligent for this (especially when using multisite and having to run GC n times this would help to save a lot of resources), i.e. we would need something like the gc conductor you guys worked on.\n\nSharing the logs on NFS mostly has historical reasons, since we wanted an easy solution to have all the logs in a single filesystem. Wendy recently added fluentbit support and support for other log collectors could be added in a similar way. Thus, I believe we should make log storage in a shared volume optional or remove it completely.",
      "range": {
        "startLine": 18,
        "startChar": 123,
        "endLine": 18,
        "endChar": 162
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fe18522f_b1bd056a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T13:52:34Z",
      "side": 1,
      "message": "From the conversation that we had weeks ago, we exposed the intention of providing a new use case (mutual exclusive from the current): a kind of HA installation with 3 primaries with all the multisite capabilities using the pull replication plugin and not sharing the file system. Each primary would have its own file system for git and log data. It is important to mention that replicas are not considered at all in this scenario.\nThis use case would not collide with the current approach and all the possible combinations because of a feature toggle.",
      "parentUuid": "44b9f15f_6c81f0a9",
      "range": {
        "startLine": 18,
        "startChar": 123,
        "endLine": 18,
        "endChar": 162
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "62a52367_376f2519",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T14:11:30Z",
      "side": 1,
      "message": "Got that. Nevertheless, even in your scenario you have to run Git GC (if not please let me know what magic you use ;-)). Thus, I think we should discuss (out of scope of this change) how we would approach that in the end, since I believe that should be part of the setup.\nNot dealing with Gerrit Replicas now is also totally fine. We can always add that later.",
      "parentUuid": "fe18522f_b1bd056a",
      "range": {
        "startLine": 18,
        "startChar": 123,
        "endLine": 18,
        "endChar": 162
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9800ad27_3a9f6546",
        "filename": "helm-charts/gerrit-operator/templates/operator.yaml",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T08:12:34Z",
      "side": 1,
      "message": "Best practice is actually to use a CustomResource to configure the operator instead of using env vars or files [1]. That is something that I have in mind of doing for a while now. If we get more options we should do that soon. Thus, leaving a note of that here.\n\n[1] https://sdk.operatorframework.io/docs/best-practices/best-practices/#running-on-cluster",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 47,
        "endChar": 68
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cfdce2d7_0aaff85d",
        "filename": "helm-charts/gerrit-operator/templates/operator.yaml",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T13:52:34Z",
      "side": 1,
      "message": "This is a very interesting point. We need to read more about that. What we understood from the conversation we had weeks ago was to bind reconcilers based on the feature toggle once the operator starts running. Can you elaborate more on your idea?",
      "parentUuid": "9800ad27_3a9f6546",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 47,
        "endChar": 68
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c0db8c5_b80219bb",
        "filename": "helm-charts/gerrit-operator/templates/operator.yaml",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T14:11:30Z",
      "side": 1,
      "message": "To be honest, I didn\u0027t look too much into the technical details yet, especially how to deal with registering the reconcilers, but the concept would look somewhat like this:\n\n- We add a new CRD, let\u0027s for example call it `GerritOperatorConfig`. The CustomResource would look something like this:\n\n```\napiVersion: \"gerritoperator.google.com/v1beta5\"\nkind: GerritOperatorConfig\nmetadata:\n  name: gerrit-operator-config\n  namespace: gerrit-operator\nspec:\n  ingressType: ISTIO\n  sharedFileSystem: true\n```\n\n- The Gerrit Operator will have a reconciler for `GerritOperatorConfig`.\n- The GerritOperator starts with default settings. It registers among the default reconcilers the `GerritOperatorConfigReconciler`.\n- Now the user can apply a custom `GerritOperatorConfig` CustomResource and the operator would reconcile it and by that reconfigure itself by for example registering the Reconcilers required by the chosen configuration.",
      "parentUuid": "cfdce2d7_0aaff85d",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 47,
        "endChar": 68
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "822a3da9_794ed5d1",
        "filename": "helm-charts/gerrit-operator/templates/operator.yaml",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2024-02-19T14:16:55Z",
      "side": 1,
      "message": "I think we should use a more explicit field name instead of `sharedFileSystem` to differentiate between the different opinionated ways to deploy a gerrit cluster, e.g. `gerritClusterType: high-availability | multi-site`",
      "parentUuid": "4c0db8c5_b80219bb",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 47,
        "endChar": 68
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3d48359e_325afddf",
        "filename": "helm-charts/gerrit-operator/templates/operator.yaml",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T15:45:22Z",
      "side": 1,
      "message": "- @thomas.draebing@sap.com , it sounds clean and modular.\n\n- @matthias.sohn@gmail.com, definitively yes, you are right.",
      "parentUuid": "822a3da9_794ed5d1",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 47,
        "endChar": 68
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74ea95b6_11a96a2d",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/OperatorModule.java",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-26T14:48:45Z",
      "side": 1,
      "message": "Please use the `EnvModule` to parse environment variables.",
      "range": {
        "startLine": 51,
        "startChar": 0,
        "endLine": 52,
        "endChar": 100
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f0f4d75_238740e0",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/OperatorModule.java",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2024-02-16T09:42:21Z",
      "side": 1,
      "message": "not yet",
      "range": {
        "startLine": 56,
        "startChar": 24,
        "endLine": 56,
        "endChar": 28
      },
      "revId": "aeaf10bfe221d8b00ea8dca9b6d17572a8190d57",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}