{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e7f80803_f4f633ff",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T11:55:44Z",
      "side": 1,
      "message": "Do we need another copy of the istio profile? It would be nice to reduce double maintenance and instead use the one provided at `./istio/gerrit.profile.yaml`. Maybe just symlink it here for convenience.",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81175a13_2f96bd8a",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T14:05:36Z",
      "side": 1,
      "message": "I agree with you. \nThe reason why we introduced a new one (based on `demo` profile) was mainly because `./istio/gerrit.profile.yaml` was not working with Minikube. Exceptions were raised when the `istio envoy proxies` were provisioned in the gerrit instances.\n\nLet us give it another try.",
      "parentUuid": "e7f80803_f4f633ff",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52b035ac_c1266380",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T16:29:07Z",
      "side": 1,
      "message": "This is the message mentioned aboved:\n```\n  Warning  FailedCreate      0s (x13 over 21s)  \n  statefulset-controller  \n  create Pod gerrit-0 in StatefulSet gerrit failed error: admission webhook \"namespace.sidecar-injector.istio.io\" denied the request: failed to run injection\n  template: template: inject:88:9: executing \"inject\" at \u003c.ProxyUID\u003e: can\u0027t\n  evaluate field ProxyUID in type *inject.SidecarTemplateData\n```",
      "parentUuid": "81175a13_2f96bd8a",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8045cd72_d77159c9",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-20T08:07:59Z",
      "side": 1,
      "message": "Ah. That is due to a version conflict. This profile here uses version 1.20.2 (line 78). Thus I assume your istioctl client is using that version. The profile already provided uses istio 1.19.4. Istio brings quite some breaking changes with each minor release. Thus, the profile has to be adapted wit heach update.\nThus, either downgrade your client to 1.19.x or push a change updating the existing profile to 1.20 (would be much appreciated)",
      "parentUuid": "52b035ac_c1266380",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbe2b84e_87f57465",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-20T09:02:46Z",
      "side": 1,
      "message": "I updated the Istio profile `./istio/gerrit.profile.yaml` locally to `1.20.2` and it works perfectly. Thank you so much. I will raise the change later today.",
      "parentUuid": "8045cd72_d77159c9",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3702fb99_6e5cf3a5",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2024-02-20T09:19:10Z",
      "side": 1,
      "message": "could you update to the latest release 1.20.3 which fixes a security issue ?\nhttps://istio.io/latest/news/releases/1.20.x/announcing-1.20.3/",
      "parentUuid": "fbe2b84e_87f57465",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e461bc7c_43b6694c",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-20T09:21:26Z",
      "side": 1,
      "message": "Of course, actually I was testing that version and the change will be against that version.",
      "parentUuid": "3702fb99_6e5cf3a5",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd1b7a79_cde29f67",
        "filename": "Documentation/examples/gerrit-istio-profile.yaml",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-20T10:05:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e461bc7c_43b6694c",
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c223703_ea876a26",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/network/istio/dependent/GerritIstioDestinationRule.java",
        "patchSetId": 1
      },
      "lineNbr": 78,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-02-19T11:55:44Z",
      "side": 1,
      "message": "Would it make sense to make this an independent option to whether a shared volume is used? Using a cookie (current option) has some disadvantages and I am not sure whether we don\u0027t have to use a more stable algorithm (that on the other hand might cause larger imbalances). So having both options available independently might make sense.\nOr if you have some experience with what algorithm works well and if using the host IP is just much better, why not make it the only choice.",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 78,
        "endChar": 19
      },
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37c4a028_d049ee0e",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/network/istio/dependent/GerritIstioDestinationRule.java",
        "patchSetId": 1
      },
      "lineNbr": 78,
      "author": {
        "id": 1149185
      },
      "writtenOn": "2024-02-19T14:05:36Z",
      "side": 1,
      "message": "The idea was to reuse the same traffic policy but we realised that in the new use case there were some edge cases where the affinity session based on cookies was not working as expected and the traffic was sent to all the pods.\n\n\u003e Would it make sense to make this an independent option to whether a shared volume is used?\n\nDefinitively it is something that we could introduce to improve flexibility. At the moment we have used this approach because was the easiest way of differentiating between use cases, taking into account that we did not want to pollute the current behaviour.",
      "parentUuid": "4c223703_ea876a26",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 78,
        "endChar": 19
      },
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce43d2f2_07ed5782",
        "filename": "operator/src/main/java/com/google/gerrit/k8s/operator/network/istio/dependent/GerritIstioDestinationRule.java",
        "patchSetId": 1
      },
      "lineNbr": 78,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2024-04-19T14:05:51Z",
      "side": 1,
      "message": "In the meantime, stickiness based on source IP has been added for all cases. Notably that only works if using the same protocol (separate sessions for HTTPS and SSH). We also observe some imbalance, but that is manageable.",
      "parentUuid": "37c4a028_d049ee0e",
      "range": {
        "startLine": 68,
        "startChar": 0,
        "endLine": 78,
        "endChar": 19
      },
      "revId": "81b50d8d58612f39d41521d3a037ba8fd93c80a2",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}